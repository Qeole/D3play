<!DOCTYPE html>
<!-- vim: set ts=2 sts=2 sw=2: -->
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <title>Sorting</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js" charset="utf-8"></script>
  </head>
  <body>

    <!--Style-->
    <style>
      body {
        font            : 10px sans-serif;
      }
      .bar rect {
        fill            : steelblue;
        shape-rendering : crispEdges;
      }
      .bar text {
        fill            : #fff;
      }
      .axis path, .axis line {
        fill            : none;
        stroke          : #000;
        shape-rendering : crispEdges;
      }
      svg {
        float           : left;
      }
    </style>

    <!--Page content - to set before calling functions-->
    <svg id="bubble"></svg>
    <svg id="insertion"></svg>
    <svg id="selection"></svg>
    <svg id="fusion"></svg>

    <div id='log'></div>
    <div id="controls">
      <button type="submit" onclick="start()">Start</button>
    </div>

    <!--External scripts - define functions-->
    <script src="main.js" charset="utf-8"></script>
    <script src="graph.js" charset="utf-8"></script>

    <!--Globals-->
    <script>
      var gMargin = { top: 10, right: 30, bottom: 30, left: 30 };
      var gPrefs = {
        maxVal      : 100,
        nbVal       : 20,
        svgWidth    : 600 - gMargin.left - gMargin.right,
        svgHeight   : 400 - gMargin.top  - gMargin.bottom,
        period      : 150,
        transition  : 100
      };
      var gXscale, gYscale;
      var gInitValues;
      var gVal;
      var gState;
    </script>

    <!--Calls to functions - call them once everything else is loaded-->
    <script>
      setInitVal();
      drawGraph();
      cloneVals();
    </script>

    <!--Remaining code-->
    <script>
      var j = 0;
      d3.selectAll("svg")
//        .on("click", clickSVG);
        .on("click", selectionLoop);
      function clickSVG () {
        swap("#" + d3.event.currentTarget.id, 1, j++)
      }
    </script>

    <script id="worker1" type="javascript/worker">
      self.onmessage = function(e) {
        self.postMessage("sending " + e.data);
      };
    </script>

    <script>
      function log(msg) {
        // Use a fragment: browser will only render/reflow once.
        var fragment = document.createDocumentFragment();
        fragment.appendChild(document.createTextNode(msg));
        fragment.appendChild(document.createElement('br'));

        document.querySelector("#log").appendChild(fragment);
      }

      var blob = new Blob([document.querySelector('#worker1').textContent]);

      var worker = new Worker(window.URL.createObjectURL(blob));
      worker.onmessage = function(e) {
        log("Received: " + e.data);
      }
      worker.postMessage('hi'); // Start the worker.
    </script>

  </body>
</html>
